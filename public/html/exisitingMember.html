<!-- Existing Member Signin Page -->
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Page Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://dhbhdrzi4tiry.cloudfront.net/cdn/sites/foundation.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../styles/styles.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.0.1/js/vendor/jquery.min.js"></script>
</head>

<body>
    <center>
        <h2>Member Login</h2>
    </center>
    <br>
    <br>
    <form data-abide novalidate>
        <div data-abide-error class="alert callout" style="display: none;">
            <p><i class="fi-alert"></i> There are some errors in your form.</p>
        </div>

        <div class="row">
            <div class="large-12 columns">


                <label>Email
                    <input type="text" placeholder="abc@email.com" id="email" required pattern="email">
                    <span class="form-error">* Please enter a valid email</span>
                </label>

                <label>Password
                    <input type="text" placeholder="" id="password" required pattern="alpha_numeric">
                    <span class="form-error">* Required Field</span>
                </label>

                <!-- Join Button -->
                <center><button type="submit" class="loginUser" id="loginUser" >Login</button></center>

            </div>
        </div>
    </form>

    <style>
        form {
            margin: auto;
            width: 300px;
        }

        h2 {
            padding-top: 200px;
        }
    </style>

    <script type="text/javascript">

        console.log('hello!');

        $(document).ready(function(){

            console.log('hello part 2!');

            var emailInput = $("#email");
            var passwordInput = $("#password");

            $(".loginUser").on("click", function(event) {
                event.preventDefault();

                console.log("hello part 3!")

                emailInput = emailInput.val().trim();
                passwordInput = passwordInput.val().trim();

                var queryURL = "/api/user_login/";
                queryURL += emailInput;

                console.log(queryURL);

                $.get(queryURL, function(data) {
                    if (data) {
                        console.log('hello part 4!');
                        console.log(data);

                        if (data.password === passwordInput) {
                            localStorage.setItem("id", data.id);
                            localStorage.setItem("allowed", true);
                            window.location.href = "/marketplace";
                        } else {
                            console.log("Wrong password!")
                        };
                    };
                });
            });
        });

    </script>

</body>

</html>